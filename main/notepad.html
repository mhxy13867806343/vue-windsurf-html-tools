<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ÁÆÄÊòìËÆ∞‰∫ãÊú¨</title>
  <style>
    /* Ê†∑ÂºèÈáçÁΩÆÂíåÂÖ®Â±ÄÊ†∑Âºè */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    }
    
    body {
      background-color: #f5f5f5;
      color: #333;
    }
    
    .container {
      display: flex;
      height: 100vh;
      overflow: hidden;
    }
    
    /* Â∑¶‰æßÂàóË°®Âå∫Âüü */
    .sidebar {
      width: 280px;
      background-color: #fff;
      border-right: 1px solid #e0e0e0;
      display: flex;
      flex-direction: column;
      height: 100%;
      overflow: hidden;
    }
    
    .sidebar-header {
      padding: 16px;
      border-bottom: 1px solid #e0e0e0;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .sidebar-title {
      font-size: 18px;
      font-weight: 600;
    }
    
    .add-btn {
      background-color: #1890ff;
      color: #fff;
      border: none;
      border-radius: 4px;
      padding: 6px 12px;
      cursor: pointer;
      transition: background-color 0.3s;
      font-size: 14px;
    }
    
    .add-btn:hover {
      background-color: #40a9ff;
    }
    
    .note-list {
      flex: 1;
      overflow-y: auto;
      padding: 8px;
    }
    
    .note-item {
      padding: 12px;
      border-radius: 4px;
      margin-bottom: 8px;
      cursor: pointer;
      transition: background-color 0.2s;
      border-left: 3px solid transparent;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .note-item:hover {
      background-color: #f0f0f0;
    }
    
    .note-item.active {
      background-color: #e6f7ff;
      border-left-color: #1890ff;
    }
    
    .note-title {
      flex: 1;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .note-title.editable {
      border-bottom: 1px solid #1890ff;
      padding-bottom: 2px;
      outline: none;
    }
    
    .delete-btn {
      visibility: hidden;
      color: #ff4d4f;
      background: none;
      border: none;
      cursor: pointer;
      font-size: 16px;
      padding: 2px 6px;
      border-radius: 2px;
      transition: all 0.2s;
    }
    
    .delete-btn:hover {
      background-color: rgba(255, 77, 79, 0.1);
    }
    
    .note-item:hover .delete-btn {
      visibility: visible;
    }
    
    .sidebar-footer {
      padding: 12px;
      border-top: 1px solid #e0e0e0;
      background-color: #fff;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .clear-all-btn {
      color: #ff4d4f;
      background: none;
      border: none;
      cursor: pointer;
      font-size: 14px;
      padding: 4px 8px;
    }
    
    .clear-all-btn:hover {
      text-decoration: underline;
    }
    
    .trash-btn {
      display: flex;
      align-items: center;
      color: #666;
      background: none;
      border: none;
      cursor: pointer;
      font-size: 14px;
      padding: 4px 8px;
    }
    
    .trash-btn:hover {
      color: #1890ff;
    }
    
    .trash-icon {
      margin-right: 4px;
    }
    
    .trash-count {
      background-color: #ff4d4f;
      color: #fff;
      font-size: 12px;
      padding: 2px 6px;
      border-radius: 10px;
      margin-left: 4px;
    }
    
    /* Âè≥‰æßÂÜÖÂÆπÂå∫Âüü */
    .content-area {
      flex: 1;
      display: flex;
      flex-direction: column;
      height: 100%;
      overflow: hidden;
    }
    
    .content-header {
      padding: 16px;
      border-bottom: 1px solid #e0e0e0;
    }
    
    .content-title {
      font-size: 20px;
      font-weight: 600;
      margin-bottom: 4px;
      outline: none;
    }
    
    .content-date {
      color: #999;
      font-size: 13px;
    }
    
    .content-editor {
      flex: 1;
      padding: 16px;
      overflow-y: auto;
    }
    
    .editor {
      width: 100%;
      height: 100%;
      border: none;
      resize: none;
      outline: none;
      font-size: 16px;
      line-height: 1.6;
      background-color: transparent;
    }
    
    .content-empty {
      height: 100%;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      color: #999;
    }
    
    .empty-icon {
      font-size: 80px;
      margin-bottom: 16px;
      opacity: 0.5;
    }
    
    .empty-text {
      font-size: 16px;
    }
    
    /* ÂõûÊî∂Á´ô */
    .trash-panel {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background-color: #fff;
      border-top: 1px solid #e0e0e0;
      box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.15);
      padding: 16px;
      transform: translateY(100%);
      transition: transform 0.3s;
      z-index: 1000;
    }
    
    .trash-panel.active {
      transform: translateY(0);
    }
    
    .trash-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }
    
    .trash-title {
      font-size: 18px;
      font-weight: 600;
      display: flex;
      align-items: center;
    }
    
    .trash-title-icon {
      margin-right: 8px;
    }
    
    .trash-close {
      background: none;
      border: none;
      font-size: 20px;
      cursor: pointer;
      color: #999;
    }
    
    .trash-settings {
      display: flex;
      align-items: center;
      margin-bottom: 16px;
    }
    
    .trash-setting-label {
      margin-right: 12px;
      color: #666;
    }
    
    .trash-select {
      padding: 6px 12px;
      border: 1px solid #d9d9d9;
      border-radius: 4px;
      outline: none;
    }
    
    .trash-list {
      max-height: 300px;
      overflow-y: auto;
    }
    
    .trash-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px;
      border-bottom: 1px solid #f0f0f0;
    }
    
    .trash-item-info {
      flex: 1;
    }
    
    .trash-item-title {
      font-weight: 500;
      margin-bottom: 4px;
    }
    
    .trash-item-date {
      font-size: 12px;
      color: #999;
    }
    
    .trash-item-expires {
      font-size: 12px;
      color: #ff4d4f;
    }
    
    .trash-item-actions {
      display: flex;
    }
    
    .restore-btn,
    .delete-forever-btn {
      background: none;
      border: none;
      padding: 4px 8px;
      margin-left: 8px;
      cursor: pointer;
      border-radius: 4px;
      font-size: 14px;
    }
    
    .restore-btn {
      color: #52c41a;
    }
    
    .restore-btn:hover {
      background-color: rgba(82, 196, 26, 0.1);
    }
    
    .delete-forever-btn {
      color: #ff4d4f;
    }
    
    .delete-forever-btn:hover {
      background-color: rgba(255, 77, 79, 0.1);
    }
    
    /* ÂØπËØùÊ°Ü */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1001;
    }
    
    .modal {
      background-color: #fff;
      border-radius: 4px;
      padding: 20px;
      width: 400px;
      max-width: 90%;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }
    
    .modal-title {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 16px;
    }
    
    .modal-content {
      margin-bottom: 20px;
    }
    
    .modal-actions {
      display: flex;
      justify-content: flex-end;
    }
    
    .modal-btn {
      padding: 8px 16px;
      margin-left: 8px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.3s;
    }
    
    .btn-cancel {
      background-color: #f0f0f0;
      border: 1px solid #d9d9d9;
      color: #666;
    }
    
    .btn-cancel:hover {
      background-color: #e0e0e0;
    }
    
    .btn-danger {
      background-color: #ff4d4f;
      border: 1px solid #ff4d4f;
      color: white;
    }
    
    .btn-danger:hover {
      background-color: #ff7875;
    }
    
    /* ÂìçÂ∫îÂºèËÆæËÆ° */
    @media screen and (max-width: 768px) {
      .container {
        flex-direction: column;
      }
      .sidebar {
        width: 100%;
        height: 50%;
        border-right: none;
        border-bottom: 1px solid #e0e0e0;
      }
      .content-area {
        height: 50%;
      }
    }
    
    .trash-checkbox {
      margin-right: 8px;
    }
  </style>
</head>
<body>
  <div id="app">
    <div class="container">
      <!-- Â∑¶‰æßÂàóË°®Âå∫Âüü -->
      <div class="sidebar">
        <div class="sidebar-header">
          <div class="sidebar-title">ÊàëÁöÑËÆ∞‰∫ãÊú¨</div>
          <button class="add-btn" @click="createNote">Êñ∞Âª∫</button>
        </div>
        <div class="note-list" @dblclick.self="createNote">
          <div v-if="!trashActive" class="notes-container">
            <div v-for="note in notes" :key="note.id" 
                 class="note-item" 
                 :class="{active: activeNoteId === note.id}" 
                 @click="selectNote(note.id)"
                 @dblclick.stop="startEditingTitle(note.id)">
              <span v-if="editingTitleId !== note.id" 
                   class="note-title" 
                   :title="note.title">
                {{note.title}}
              </span>
              <span v-else 
                   class="note-title editable" 
                   contenteditable="true" 
                   @blur="finishEditTitle"
                   @keydown.enter.prevent="finishEditTitle"></span>
              <span class="note-date">{{formatDate(note.updatedAt)}}</span>
              <button class="delete-btn" @click.stop="confirmDeleteNote(note.id)" title="Âà†Èô§Á¨îËÆ∞">üóëÔ∏è</button>
            </div>
          </div>
          <div v-else>
            <div v-for="note in trashedNotes" :key="note.id" class="trash-item">
              <input type="checkbox" class="trash-checkbox" v-model="selectedTrashedIds" :value="note.id">
              <div class="trash-item-info">
                <div class="trash-item-title">{{ note.title }}</div>
                <div class="trash-item-date">Âà†Èô§‰∫é: {{ formatDate(note.deletedAt) }}</div>
                <div class="trash-item-expires">
                  {{ getExpiryText(note.deletedAt) }}
                </div>
              </div>
              <div class="trash-item-actions">
                <button class="restore-btn" @click="restoreNote(note.id)">ÊÅ¢Â§ç</button>
                <button class="delete-forever-btn" @click="confirmDeleteForever(note.id)">ÂΩªÂ∫ïÂà†Èô§</button>
              </div>
            </div>
          </div>
        </div>
        <div class="sidebar-footer">
          <button class="clear-all-btn" @click="confirmClearAll">Ê∏ÖÁ©∫ÊâÄÊúâËÆ∞ÂΩï</button>
          <button class="trash-btn" @click="toggleTrash">
            <span class="trash-icon">üóëÔ∏è</span>
            <span>ÂõûÊî∂Á´ô</span>
            <span class="trash-count" v-if="trashedNotes.length">{{ trashedNotes.length }}</span>
          </button>
        </div>
      </div>
      
      <!-- Âè≥‰æßÂÜÖÂÆπÂå∫Âüü -->
      <div class="content-area">
        <template v-if="activeNote">
          <div class="content-header">
            <div 
              class="content-title"
              contenteditable
              @blur="updateTitle"
              @keydown.enter.prevent="updateTitle"
            >{{ activeNote.title }}</div>
            <div class="content-date">
              {{ formatDate(activeNote.updatedAt) }}
            </div>
          </div>
          <div class="content-editor">
            <textarea 
              class="editor" 
              v-model="activeNote.content"
              @input="updateContent"
              placeholder="Âú®ËøôÈáåÂºÄÂßãËÆ∞ÂΩï..."
            ></textarea>
          </div>
        </template>
        <div class="content-empty" v-else>
          <div class="empty-icon">üìù</div>
          <div class="empty-text">ÈÄâÊã©‰∏Ä‰∏™Á¨îËÆ∞ÊàñÂàõÂª∫Êñ∞Á¨îËÆ∞</div>
        </div>
      </div>
    </div>
    
    <!-- ÂõûÊî∂Á´ôÈù¢Êùø -->
    <div class="trash-panel" :class="{ active: trashActive }">
      <div class="trash-header">
        <div class="trash-title">
          <span class="trash-title-icon">üóëÔ∏è</span>
          <span>ÂõûÊî∂Á´ô</span>
        </div>
        <button class="trash-close" @click="toggleTrash">&times;</button>
      </div>
      
      <div class="trash-settings">
        <div class="trash-setting-label">Âà†Èô§È°πÁõÆ‰øùÁïôÊó∂Èó¥:</div>
        <select class="trash-select" v-model="trashRetentionDays">
          <option value="7">7 Â§©</option>
          <option value="15">15 Â§©</option>
          <option value="30">30 Â§©</option>
          <option value="60">60 Â§©</option>
          <option value="90">90 Â§©</option>
          <option value="180">180 Â§©</option>
        </select>
      </div>
      
      <div class="trash-list">
        <div v-if="trashedNotes.length === 0" style="padding: 20px; text-align: center; color: #999;">
          ÂõûÊî∂Á´ô‰∏∫Á©∫
        </div>
        <div v-for="note in trashedNotes" :key="note.id" class="trash-item">
          <input type="checkbox" class="trash-checkbox" v-model="selectedTrashedIds" :value="note.id">
          <div class="trash-item-info">
            <div class="trash-item-title">{{ note.title }}</div>
            <div class="trash-item-date">Âà†Èô§‰∫é: {{ formatDate(note.deletedAt) }}</div>
            <div class="trash-item-expires">
              {{ getExpiryText(note.deletedAt) }}
            </div>
          </div>
          <div class="trash-item-actions">
            <button class="restore-btn" @click="restoreNote(note.id)">ÊÅ¢Â§ç</button>
            <button class="delete-forever-btn" @click="confirmDeleteForever(note.id)">ÂΩªÂ∫ïÂà†Èô§</button>
          </div>
        </div>
      </div>
      <div class="trash-actions" style="padding-top: 16px; display: flex; justify-content: space-between;">
        <button v-if="trashedNotes.length > 0" @click="confirmRestoreAll" style="padding: 8px 16px; background: #52c41a; color: white; border: none; border-radius: 4px; cursor: pointer;">‰∏ÄÈîÆÊÅ¢Â§çÂÖ®ÈÉ®</button>
        <div>
          <button v-if="selectedTrashedIds.length > 0" @click="restoreSelected" style="padding: 8px 16px; background: #40a9ff; color: white; border: none; border-radius: 4px; margin-right: 8px; cursor: pointer;">ÊÅ¢Â§çÈÄâ‰∏≠</button>
          <button v-if="selectedTrashedIds.length > 0" @click="confirmDeleteSelected" style="padding: 8px 16px; background: #ff4d4f; color: white; border: none; border-radius: 4px; cursor: pointer;">Âà†Èô§ÈÄâ‰∏≠</button>
        </div>
      </div>
    </div>
    
    <!-- Á°ÆËÆ§ÂØπËØùÊ°Ü -->
    <div class="modal-overlay" v-if="showConfirmDialog" @click.self="cancelConfirmDialog">
      <div class="modal">
        <div class="modal-title">{{ confirmDialogTitle }}</div>
        <div class="modal-content">{{ confirmDialogContent }}</div>
        <div class="modal-actions">
          <button class="modal-btn btn-cancel" @click="cancelConfirmDialog">ÂèñÊ∂à</button>
          <button class="modal-btn btn-danger" @click="confirmAction">Á°ÆËÆ§</button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- ÂºïÂÖ• Vue 3 -->
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
  
  <script>
    const { createApp, ref, computed, nextTick, watch } = Vue;
    
    createApp({
      setup() {
        // Êú¨Âú∞Â≠òÂÇ®ÁöÑÈîÆÂêç
        const STORAGE_KEY = 'vue-notepad-data';
        const TRASH_RETENTION_KEY = 'vue-notepad-trash-retention';
        
        // ‰ªéÊú¨Âú∞Â≠òÂÇ®Âä†ËΩΩÊï∞ÊçÆ
        const loadFromStorage = () => {
          const storedData = localStorage.getItem(STORAGE_KEY);
          if (storedData) {
            try {
              return JSON.parse(storedData);
            } catch (e) {
              console.error('Êó†Ê≥ïËß£ÊûêÊú¨Âú∞Â≠òÂÇ®ÁöÑÊï∞ÊçÆ', e);
              return { notes: [], trashedNotes: [] };
            }
          }
          return { notes: [], trashedNotes: [] };
        };
        
        // Â∑≤ÈÄâÊã©ÁöÑÂõûÊî∂Á´ôÁ¨îËÆ∞ID
        const selectedTrashedIds = ref([]);
        
        // ‰øùÂ≠òÊï∞ÊçÆÂà∞Êú¨Âú∞Â≠òÂÇ®
        const saveToStorage = (data) => {
          localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
        };
        
        // Âä†ËΩΩÊï∞ÊçÆ
        const storedData = loadFromStorage();
        
        // Á¨îËÆ∞ÂàóË°®
        const notes = ref(storedData.notes || []);
        
        // Â∑≤Âà†Èô§ÁöÑÁ¨îËÆ∞ÂàóË°®
        const trashedNotes = ref(storedData.trashedNotes || []);
        
        // ÂΩìÂâçÊøÄÊ¥ªÁöÑÁ¨îËÆ∞ID
        const activeNoteId = ref(null);
        
        // ÂΩìÂâçÊ≠£Âú®ÁºñËæëÊ†áÈ¢òÁöÑÁ¨îËÆ∞ID
        const editingTitleId = ref(null);
        
        // ÂõûÊî∂Á´ôÈù¢ÊùøÊøÄÊ¥ªÁä∂ÊÄÅ
        const trashActive = ref(false);
        
        // ÂõûÊî∂Á´ô‰øùÁïôÂ§©Êï∞
        const trashRetentionDays = ref(localStorage.getItem(TRASH_RETENTION_KEY) || '7');
        
        // ÁõëÂê¨ÂõûÊî∂Á´ô‰øùÁïôÂ§©Êï∞ÂèòÂåñ
        watch(trashRetentionDays, (newValue) => {
          localStorage.setItem(TRASH_RETENTION_KEY, newValue);
        });
        
        // ÂΩìÂâçÊøÄÊ¥ªÁöÑÁ¨îËÆ∞
        const activeNote = computed(() => {
          if (!activeNoteId.value) return null;
          return notes.value.find(note => note.id === activeNoteId.value) || null;
        });
        
        // Á°ÆËÆ§ÂØπËØùÊ°ÜÁä∂ÊÄÅ
        const showConfirmDialog = ref(false);
        const confirmDialogTitle = ref('');
        const confirmDialogContent = ref('');
        const confirmCallback = ref(null);
        
        // ÊâìÂºÄÁ°ÆËÆ§ÂØπËØùÊ°Ü
        const openConfirmDialog = (title, content, callback) => {
          confirmDialogTitle.value = title;
          confirmDialogContent.value = content;
          confirmCallback.value = callback;
          showConfirmDialog.value = true;
        };
        
        // ÂèñÊ∂àÁ°ÆËÆ§ÂØπËØùÊ°Ü
        const cancelConfirmDialog = () => {
          showConfirmDialog.value = false;
        };
        
        // Á°ÆËÆ§Êìç‰Ωú
        const confirmAction = () => {
          if (confirmCallback.value) {
            confirmCallback.value();
          }
          showConfirmDialog.value = false;
        };
        
        // Ê†ºÂºèÂåñÊó•Êúü
        const formatDate = (timestamp) => {
          const date = new Date(timestamp);
          return date.toLocaleString('zh-CN', {
            year: 'numeric',
            month: '2-digit',
            day: '2-digit',
            hour: '2-digit',
            minute: '2-digit'
          });
        };
        
        // Ëé∑ÂèñÂà∞ÊúüÊñáÊú¨
        const getExpiryText = (deletedAt) => {
          const expiryDate = new Date(deletedAt);
          expiryDate.setDate(expiryDate.getDate() + parseInt(trashRetentionDays.value, 10));
          
          const now = new Date();
          const diffTime = expiryDate - now;
          const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
          
          return `Â∞ÜÂú®${diffDays}Â§©ÂêéÊ∞∏‰πÖÂà†Èô§`;
        };
        
        // ÂàõÂª∫Êñ∞Á¨îËÆ∞
        const createNote = () => {
          // Ê£ÄÊü•ÊòØÂê¶Â≠òÂú®Êú™ÂëΩÂêçÁöÑÁ¨îËÆ∞
          const untitledNote = notes.value.find(note => note.title === 'Êú™ÂëΩÂêçÁ¨îËÆ∞');
          if (untitledNote) {
            selectNote(untitledNote.id);
            return;
          }
          
          const newNote = {
            id: Date.now().toString(),
            title: 'Êú™ÂëΩÂêçÁ¨îËÆ∞',
            content: '',
            createdAt: Date.now(),
            updatedAt: Date.now()
          };
          
          notes.value.unshift(newNote);
          saveToStorage({ notes: notes.value, trashedNotes: trashedNotes.value });
          
          selectNote(newNote.id);
          startEditingTitle(newNote.id);
        };
        
        // ÂºÄÂßãÁºñËæëÊ†áÈ¢ò
        const startEditingTitle = async (noteId) => {
          editingTitleId.value = noteId;
          await nextTick();
          const titleEditor = document.querySelector('.note-title.editable');
          if (titleEditor) {
            titleEditor.focus();
            // Â∞ÜÂÖâÊ†áÁßªÂä®Âà∞ÊñáÊú¨Êú´Â∞æ
            const range = document.createRange();
            const selection = window.getSelection();
            range.selectNodeContents(titleEditor);
            range.collapse(false);
            selection.removeAllRanges();
            selection.addRange(range);
          }
        };
        
        // ÂÆåÊàêÁºñËæëÊ†áÈ¢ò
        const finishEditTitle = () => {
          if (!editingTitleId.value) return;
          
          const titleEditor = document.querySelector('.note-title.editable');
          if (!titleEditor) {
            editingTitleId.value = null;
            return;
          }
          
          let newTitle = titleEditor.textContent.trim();
          if (!newTitle) {
            newTitle = 'Êú™ÂëΩÂêçÁ¨îËÆ∞';
          }
          
          // Ê£ÄÊü•Ê†áÈ¢òÊòØÂê¶ÈáçÂ§ç
          const isDuplicate = notes.value.some(note => 
            note.id !== editingTitleId.value && note.title === newTitle
          );
          
          if (isDuplicate) {
            alert('Ê†áÈ¢òÂ∑≤Â≠òÂú®ÔºåËØ∑‰ΩøÁî®ÂÖ∂‰ªñÊ†áÈ¢ò');
            titleEditor.focus();
            return;
          }
          
          const noteIndex = notes.value.findIndex(note => note.id === editingTitleId.value);
          if (noteIndex !== -1) {
            notes.value[noteIndex].title = newTitle;
            notes.value[noteIndex].updatedAt = Date.now();
            saveToStorage({ notes: notes.value, trashedNotes: trashedNotes.value });
          }
          
          editingTitleId.value = null;
        };
        
        // ÈÄâÊã©Á¨îËÆ∞
        const selectNote = (noteId) => {
          activeNoteId.value = noteId;
        };
        
        // Êõ¥Êñ∞Ê†áÈ¢ò
        const updateTitle = (event) => {
          if (!activeNote.value) return;
          
          let newTitle = event.target.textContent.trim();
          if (!newTitle) {
            newTitle = 'Êú™ÂëΩÂêçÁ¨îËÆ∞';
            event.target.textContent = newTitle;
          }
          
          // Ê£ÄÊü•Ê†áÈ¢òÊòØÂê¶ÈáçÂ§ç
          const isDuplicate = notes.value.some(note => 
            note.id !== activeNote.value.id && note.title === newTitle
          );
          
          if (isDuplicate) {
            alert('Ê†áÈ¢òÂ∑≤Â≠òÂú®ÔºåËØ∑‰ΩøÁî®ÂÖ∂‰ªñÊ†áÈ¢ò');
            event.target.textContent = activeNote.value.title;
            event.target.focus();
            return;
          }
          
          activeNote.value.title = newTitle;
          activeNote.value.updatedAt = Date.now();
          saveToStorage({ notes: notes.value, trashedNotes: trashedNotes.value });
        };
        
        // Êõ¥Êñ∞ÂÜÖÂÆπ
        const updateContent = () => {
          if (!activeNote.value) return;
          
          activeNote.value.updatedAt = Date.now();
          saveToStorage({ notes: notes.value, trashedNotes: trashedNotes.value });
        };
        
        // Á°ÆËÆ§Âà†Èô§Á¨îËÆ∞
        const confirmDeleteNote = (noteId) => {
          const note = notes.value.find(note => note.id === noteId);
          if (!note) return;
          
          openConfirmDialog(
            'Âà†Èô§Á¨îËÆ∞',
            `Á°ÆÂÆöË¶ÅÂà†Èô§„Äå${note.title}„ÄçÂêóÔºüÂÆÉÂ∞ÜË¢´ÁßªÂà∞ÂõûÊî∂Á´ô„ÄÇ`,
            () => deleteNote(noteId)
          );
        };
        
        // Âà†Èô§Á¨îËÆ∞
        const deleteNote = (noteId) => {
          const noteIndex = notes.value.findIndex(note => note.id === noteId);
          if (noteIndex === -1) return;
          
          const deletedNote = { ...notes.value[noteIndex], deletedAt: Date.now() };
          trashedNotes.value.push(deletedNote);
          
          notes.value.splice(noteIndex, 1);
          
          if (activeNoteId.value === noteId) {
            activeNoteId.value = notes.value.length > 0 ? notes.value[0].id : null;
          }
          
          saveToStorage({ notes: notes.value, trashedNotes: trashedNotes.value });
        };
        
        // Á°ÆËÆ§Ê∏ÖÁ©∫ÊâÄÊúâËÆ∞ÂΩï
        const confirmClearAll = () => {
          if (notes.value.length === 0) {
            alert('Ê≤°ÊúâÁ¨îËÆ∞ÂèØÊ∏ÖÁ©∫');
            return;
          }
          
          openConfirmDialog(
            'Ê∏ÖÁ©∫ÊâÄÊúâÁ¨îËÆ∞',
            'Á°ÆÂÆöË¶ÅÊ∏ÖÁ©∫ÊâÄÊúâÁ¨îËÆ∞ÂêóÔºüÊ≠§Êìç‰ΩúÂ∞ÜÊääÊâÄÊúâÁ¨îËÆ∞ÁßªÂà∞ÂõûÊî∂Á´ô„ÄÇ',
            clearAllNotes
          );
        };
        
        // Ê∏ÖÁ©∫ÊâÄÊúâÁ¨îËÆ∞
        const clearAllNotes = () => {
          const now = Date.now();
          const deletedNotes = notes.value.map(note => ({ ...note, deletedAt: now }));
          trashedNotes.value.push(...deletedNotes);
          
          notes.value = [];
          activeNoteId.value = null;
          
          saveToStorage({ notes: notes.value, trashedNotes: trashedNotes.value });
        };
        
        // ÂàáÊç¢ÂõûÊî∂Á´ôÈù¢Êùø
        const toggleTrash = () => {
          trashActive.value = !trashActive.value;
          
          // Ê∏ÖÁêÜËøáÊúüÁöÑÂ∑≤Âà†Èô§Á¨îËÆ∞
          if (trashActive.value) {
            cleanupExpiredTrash();
            // Ê∏ÖÁ©∫ÈÄâÊã©
            selectedTrashedIds.value = [];
          }
        };
        
        // Â§ÑÁêÜÁ©∫ÁôΩÂå∫ÂüüÂèåÂáª‰∫ã‰ª∂
        const handleBlankAreaDblClick = (event) => {
          // Á°Æ‰øùÁÇπÂáªÁöÑÊòØÁ©∫ÁôΩÂå∫ÂüüÔºå‰∏çÊòØÂ≠êÂÖÉÁ¥†
          if (event.target === event.currentTarget) {
            createNote();
          }
        };
        
        // Á°ÆËÆ§ÊÅ¢Â§çÊâÄÊúâÁ¨îËÆ∞
        const confirmRestoreAll = () => {
          if (trashedNotes.value.length === 0) {
            alert('ÂõûÊî∂Á´ô‰∏∫Á©∫');
            return;
          }
          
          openConfirmDialog(
            'ÊÅ¢Â§çÊâÄÊúâÁ¨îËÆ∞',
            'Á°ÆÂÆöË¶ÅÊÅ¢Â§çÂõûÊî∂Á´ô‰∏≠ÁöÑÊâÄÊúâÁ¨îËÆ∞ÂêóÔºü',
            restoreAllNotes
          );
        };
        
        // ÊÅ¢Â§çÊâÄÊúâÁ¨îËÆ∞
        const restoreAllNotes = () => {
          // ‰∏Ä‰∏™‰∏Ä‰∏™ÊÅ¢Â§ç‰ª•Â§ÑÁêÜÂèØËÉΩÁöÑÊ†áÈ¢òÂÜ≤Á™Å
          [...trashedNotes.value].forEach(note => {
            restoreNote(note.id);
          });
        };
        
        // Á°ÆËÆ§Âà†Èô§ÈÄâ‰∏≠ÁöÑÁ¨îËÆ∞
        const confirmDeleteSelected = () => {
          if (selectedTrashedIds.value.length === 0) {
            alert('ËØ∑ÂÖàÈÄâÊã©Ë¶ÅÂà†Èô§ÁöÑÁ¨îËÆ∞');
            return;
          }
          
          openConfirmDialog(
            'Ê∞∏‰πÖÂà†Èô§ÈÄâ‰∏≠ÁöÑÁ¨îËÆ∞',
            `Á°ÆÂÆöË¶ÅÊ∞∏‰πÖÂà†Èô§ÈÄâ‰∏≠ÁöÑ ${selectedTrashedIds.value.length} Êù°Á¨îËÆ∞ÂêóÔºüÊ≠§Êìç‰ΩúÊó†Ê≥ïÊí§ÈîÄ„ÄÇ`,
            deleteSelectedNotes
          );
        };
        
        // Âà†Èô§ÈÄâ‰∏≠ÁöÑÁ¨îËÆ∞
        const deleteSelectedNotes = () => {
          selectedTrashedIds.value.forEach(id => {
            deleteForever(id);
          });
          selectedTrashedIds.value = [];
        };
        
        // ÊÅ¢Â§çÁ¨îËÆ∞
        const restoreNote = (noteId) => {
          const noteIndex = trashedNotes.value.findIndex(note => note.id === noteId);
          if (noteIndex === -1) return;
          
          const restoredNote = { ...trashedNotes.value[noteIndex] };
          delete restoredNote.deletedAt;
          
          // Ê£ÄÊü•Ê†áÈ¢òÊòØÂê¶ÈáçÂ§ç
          let uniqueTitle = restoredNote.title;
          let counter = 1;
          
          while (notes.value.some(note => note.title === uniqueTitle)) {
            uniqueTitle = `${restoredNote.title} (${counter})`;
            counter++;
          }
          
          restoredNote.title = uniqueTitle;
          restoredNote.updatedAt = Date.now();
          
          notes.value.unshift(restoredNote);
          trashedNotes.value.splice(noteIndex, 1);
          
          saveToStorage({ notes: notes.value, trashedNotes: trashedNotes.value });
        };
        
        // Á°ÆËÆ§Ê∞∏‰πÖÂà†Èô§Á¨îËÆ∞
        const confirmDeleteForever = (noteId) => {
          const note = trashedNotes.value.find(note => note.id === noteId);
          if (!note) return;
          
          openConfirmDialog(
            'Ê∞∏‰πÖÂà†Èô§',
            `Á°ÆÂÆöË¶ÅÊ∞∏‰πÖÂà†Èô§„Äå${note.title}„ÄçÂêóÔºüÊ≠§Êìç‰ΩúÊó†Ê≥ïÊí§ÈîÄ„ÄÇ`,
            () => deleteForever(noteId)
          );
        };
        
        // Ê∞∏‰πÖÂà†Èô§Á¨îËÆ∞
        const deleteForever = (noteId) => {
          const noteIndex = trashedNotes.value.findIndex(note => note.id === noteId);
          if (noteIndex === -1) return;
          
          trashedNotes.value.splice(noteIndex, 1);
          saveToStorage({ notes: notes.value, trashedNotes: trashedNotes.value });
        };
        
        // Ê∏ÖÁêÜËøáÊúüÁöÑÂ∑≤Âà†Èô§Á¨îËÆ∞
        const cleanupExpiredTrash = () => {
          const now = Date.now();
          const retentionMs = parseInt(trashRetentionDays.value, 10) * 24 * 60 * 60 * 1000;
          
          trashedNotes.value = trashedNotes.value.filter(note => {
            const expiryTime = note.deletedAt + retentionMs;
            return expiryTime > now;
          });
          
          saveToStorage({ notes: notes.value, trashedNotes: trashedNotes.value });
        };
        
        // ÂàùÂßãÂåñÈªòËÆ§ÈÄâÊã©Á¨¨‰∏Ä‰∏™Á¨îËÆ∞
        if (notes.value.length > 0) {
          activeNoteId.value = notes.value[0].id;
        }
        
        // Ëá™Âä®Ê∏ÖÁêÜËøáÊúüÁöÑÂ∑≤Âà†Èô§Á¨îËÆ∞
        cleanupExpiredTrash();
        
        // ÊÅ¢Â§çÈÄâ‰∏≠ÁöÑÁ¨îËÆ∞
        const restoreSelected = () => {
          if (selectedTrashedIds.value.length === 0) return;
          
          [...selectedTrashedIds.value].forEach(id => {
            restoreNote(id);
          });
          
          selectedTrashedIds.value = [];
        };
        
        return {
          notes,
          trashedNotes,
          activeNoteId,
          editingTitleId,
          activeNote,
          trashActive,
          trashRetentionDays,
          showConfirmDialog,
          confirmDialogTitle,
          confirmDialogContent,
          selectedTrashedIds,
          formatDate,
          getExpiryText,
          createNote,
          selectNote,
          updateTitle,
          updateContent,
          startEditingTitle,
          finishEditTitle,
          confirmDeleteNote,
          confirmClearAll,
          toggleTrash,
          restoreNote,
          restoreSelected,
          confirmDeleteForever,
          cancelConfirmDialog,
          confirmAction,
          handleBlankAreaDblClick,
          confirmRestoreAll,
          confirmDeleteSelected
        };
      }
    }).mount('#app');
  </script>
</body>
</html>
