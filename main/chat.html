<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vue 3 ËÅäÂ§©Â∫îÁî®</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      color: #333;
      background-color: #f0f2f5;
      height: 100vh;
      overflow: hidden;
    }
    
    .app-container {
      display: flex;
      height: 100vh;
    }
    
    /* Â∑¶‰æßËÅîÁ≥ª‰∫∫ÂàóË°® */
    .contact-list {
      width: 280px;
      background-color: #fafafa;
      border-right: 1px solid #e5e5e5;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }
    
    .search-container {
      padding: 15px;
      border-bottom: 1px solid #e5e5e5;
      background: #fff;
    }
    
    .search-input {
      width: 100%;
      padding: 8px 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 14px;
    }
    
    .contacts {
      flex: 1;
      overflow-y: auto;
    }
    
    .contact-item {
      padding: 12px 15px;
      display: flex;
      align-items: center;
      cursor: pointer;
      transition: background-color 0.2s;
    }
    
    .contact-item:hover {
      background-color: #f0f0f0;
    }
    
    .contact-item.active {
      background-color: #e6f7ff;
    }
    
    .avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      margin-right: 10px;
      background-color: #e1e1e1;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }
    
    .avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    .contact-info {
      flex: 1;
    }
    
    .contact-name {
      font-size: 15px;
      margin-bottom: 4px;
      font-weight: 500;
    }
    
    .last-message {
      font-size: 13px;
      color: #888;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .time {
      font-size: 12px;
      color: #999;
      margin-left: 8px;
    }
    
    /* ‰∏≠Èó¥ËÅäÂ§©Âå∫Âüü */
    .chat-area {
      flex: 1;
      display: flex;
      flex-direction: column;
      border-right: 1px solid #e5e5e5;
      background-color: #fff;
    }
    
    .chat-header {
      padding: 15px;
      border-bottom: 1px solid #e5e5e5;
      display: flex;
      align-items: center;
      background: #fff;
      height: 60px;
    }
    
    .chat-title {
      font-size: 16px;
      font-weight: 500;
    }
    
    .message-container {
      flex: 1;
      padding: 15px;
      overflow-y: auto;
      background-color: #f5f5f5;
    }
    
    .message {
      margin-bottom: 15px;
      display: flex;
    }
    
    .message.incoming {
      flex-direction: row;
    }
    
    .message.outgoing {
      flex-direction: row-reverse;
    }
    
    .message-content {
      padding: 10px 15px;
      border-radius: 4px;
      max-width: 70%;
      position: relative;
      word-break: break-word;
    }
    
    .incoming .message-content {
      background-color: #fff;
      margin-left: 10px;
      border-top-left-radius: 0;
    }
    
    .outgoing .message-content {
      background-color: #95ec69;
      margin-right: 10px;
      border-top-right-radius: 0;
    }
    
    .message-time {
      font-size: 12px;
      color: #999;
      margin-top: 5px;
      text-align: right;
    }
    
    .message-input {
      padding: 15px;
      border-top: 1px solid #e5e5e5;
      background-color: #fff;
    }
    
    .input-container {
      display: flex;
      align-items: center;
    }
    
    .emoji-button {
      margin-right: 10px;
      font-size: 24px;
      cursor: pointer;
      color: #888;
      position: relative;
    }
    
    .emoji-picker-container {
      position: absolute;
      bottom: 40px;
      left: 0;
      z-index: 100;
      background: #fff;
      border-radius: 4px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.2);
      width: 300px;
      padding: 10px;
      display: grid;
      grid-template-columns: repeat(8, 1fr);
      gap: 5px;
      max-height: 200px;
      overflow-y: auto;
    }
    
    .emoji-item {
      font-size: 24px;
      cursor: pointer;
      text-align: center;
      padding: 5px;
      border-radius: 4px;
      transition: background-color 0.2s;
    }
    
    .emoji-item:hover {
      background-color: #f0f0f0;
    }
    
    .file-button {
      margin-right: 10px;
      font-size: 18px;
      cursor: pointer;
      color: #888;
    }
    .text-input-container{
      width: 100%;
    }
    .text-input {
      width: 100%;
      flex: 1;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      resize: none;
      height: 80px;
      font-family: inherit;
      font-size: 14px;
    }
    
    .send-button {
      margin-left: 10px;
      padding: 8px 20px;
      background-color: #1aad19;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
    }
    
    .send-button:disabled {
      background-color: #9fd09e;
      cursor: not-allowed;
    }
    
    /* Âè≥‰æßËØ¶ÊÉÖÂå∫Âüü */
    .detail-panel {
      width: 280px;
      background-color: #fafafa;
      overflow-y: auto;
    }
    
    .detail-header {
      padding: 20px 15px;
      border-bottom: 1px solid #e5e5e5;
      text-align: center;
    }
    
    .detail-avatar {
      width: 70px;
      height: 70px;
      border-radius: 50%;
      margin: 0 auto 15px;
      background-color: #e1e1e1;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }
    
    .detail-avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    .detail-name {
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 5px;
    }
    
    .detail-id {
      font-size: 14px;
      color: #666;
    }
    
    .detail-section {
      padding: 15px;
      border-bottom: 1px solid #e5e5e5;
    }
    
    .section-title {
      font-size: 14px;
      color: #888;
      margin-bottom: 15px;
    }
    
    .detail-item {
      display: flex;
      align-items: center;
      margin-bottom: 10px;
    }
    
    .item-icon {
      width: 18px;
      height: 18px;
      margin-right: 10px;
      color: #888;
    }
    
    .item-text {
      font-size: 14px;
      flex: 1;
    }
    
    /* ÊêúÁ¥¢Á©∫ÁªìÊûúÊ†∑Âºè */
    .empty-search {
      padding: 30px 20px;
      text-align: center;
      color: #999;
    }
    
    .empty-search-icon {
      font-size: 40px;
      margin-bottom: 10px;
      color: #ddd;
    }
    
    /* Êñá‰ª∂‰∏ä‰º†Áõ∏ÂÖ≥Ê†∑Âºè */
    .file-upload {
      display: none;
    }
    
    .upload-preview {
      display: flex;
      flex-wrap: wrap;
      padding: 5px;
      margin-top: 5px;
      gap: 5px;
    }
    
    .upload-item {
      position: relative;
      width: 60px;
      height: 60px;
      border-radius: 4px;
      overflow: hidden;
      border: 1px solid #ddd;
    }
    
    .upload-item img, .upload-item video {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    .upload-item.file {
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: #f8f8f8;
      font-size: 24px;
      color: #999;
    }
    
    .upload-remove {
      position: absolute;
      top: -5px;
      right: -5px;
      width: 18px;
      height: 18px;
      background: rgba(0,0,0,0.5);
      color: #fff;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      cursor: pointer;
    }
    
    .message-file {
      display: flex;
      align-items: center;
      background-color: #f8f8f8;
      padding: 8px;
      border-radius: 4px;
      margin-top: 5px;
    }
    
    .message-file-icon {
      font-size: 24px;
      margin-right: 10px;
      color: #666;
    }
    
    .message-file-info {
      flex: 1;
    }
    
    .message-file-name {
      font-size: 14px;
      margin-bottom: 2px;
    }
    
    .message-file-size {
      font-size: 12px;
      color: #999;
    }
    
    .message-file-download {
      color: #1aad19;
      font-size: 12px;
      cursor: pointer;
    }
    
    .message-media {
      margin-top: 5px;
      max-width: 200px;
    }
    
    .message-image {
      max-width: 100%;
      border-radius: 4px;
      cursor: pointer;
    }
    
    .message-video {
      max-width: 100%;
      border-radius: 4px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div id="app">
    <div class="app-container">
      <!-- Â∑¶‰æßËÅîÁ≥ª‰∫∫ÂàóË°® -->
      <div class="contact-list">
        <div class="search-container">
          <input type="text" class="search-input" placeholder="ÊêúÁ¥¢" v-model="searchQuery">
        </div>
        <div class="contacts">
          <template v-if="filteredContacts.length > 0">
            <div 
              v-for="(contact, index) in filteredContacts" 
              :key="contact.id" 
              class="contact-item" 
              :class="{ active: activeContactId === contact.id }"
              @click="selectContact(contact.id)">
              <div class="avatar">
                <img :src="contact.avatar" :alt="contact.name">
              </div>
              <div class="contact-info">
                <div class="contact-name">{{ contact.name }}</div>
                <div class="last-message">{{ contact.lastMessage }}</div>
              </div>
              <div class="time">{{ contact.lastTime }}</div>
            </div>
          </template>
          <div v-else class="empty-search">
            <div class="empty-search-icon">üîç</div>
            <div>Ê≤°ÊúâÊâæÂà∞Áõ∏ÂÖ≥ËÅîÁ≥ª‰∫∫</div>
          </div>
        </div>
      </div>
      
      <!-- ‰∏≠Èó¥ËÅäÂ§©Âå∫Âüü -->
      <div class="chat-area" v-if="activeContact">
        <div class="chat-header">
          <div class="chat-title">{{ activeContact.name }}</div>
        </div>
        <div class="message-container" ref="messageContainer">
          <div 
            v-for="(message, index) in activeContact.messages" 
            :key="index" 
            class="message" 
            :class="message.outgoing ? 'outgoing' : 'incoming'">
            <div class="avatar" v-if="!message.outgoing">
              <img :src="activeContact.avatar" :alt="activeContact.name">
            </div>
            <div class="message-content">
              {{ message.content }}
              
              <!-- Â¶ÇÊûúÊòØÂõæÁâáÊ∂àÊÅØ -->
              <div v-if="message.image" class="message-media">
                <img :src="message.image" alt="ÂõæÁâá" class="message-image" @click="previewMedia(message.image)">
              </div>
              
              <!-- Â¶ÇÊûúÊòØËßÜÈ¢ëÊ∂àÊÅØ -->
              <div v-if="message.video" class="message-media">
                <video :src="message.video" class="message-video" controls></video>
              </div>
              
              <!-- Â¶ÇÊûúÊòØÊñá‰ª∂Ê∂àÊÅØ -->
              <div v-if="message.file" class="message-file">
                <div class="message-file-icon">üìÑ</div>
                <div class="message-file-info">
                  <div class="message-file-name">{{ message.fileName }}</div>
                  <div class="message-file-size">{{ message.fileSize }}</div>
                </div>
                <div class="message-file-download">‰∏ãËΩΩ</div>
              </div>
              
              <div class="message-time">{{ message.time }}</div>
            </div>
            <div class="avatar" v-if="message.outgoing">
              <img src="https://via.placeholder.com/40" alt="Êàë">
            </div>
          </div>
        </div>
        <div class="message-input">
          <div class="input-container">
            <div class="emoji-button" @click="toggleEmojiPicker">üòä</div>
            <div class="emoji-picker-container" v-if="showEmojiPicker" @click.stop>
              <div v-for="(emoji, index) in emojiList" :key="index" class="emoji-item" @click="selectEmoji(emoji)">
                {{ emoji }}
              </div>
            </div>
            <div class="file-button" @click="triggerFileUpload">üìé</div>
            <input 
              type="file" 
              class="file-upload" 
              ref="fileInput"
              @change="handleFileUpload"
              multiple
              accept="image/*,video/*,.pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.txt">
            <div class="text-input-container">
              <textarea 
                class="text-input" 
                v-model="newMessage" 
                @keyup.enter="sendMessage"
                placeholder="ËæìÂÖ•Ê∂àÊÅØ..."></textarea>
              <div v-if="uploadFiles.length > 0" class="upload-preview">
                <div v-for="(file, index) in uploadFiles" :key="index" class="upload-item" :class="{file: !isImageOrVideo(file.file)}">
                  <template v-if="isImage(file.file)">
                    <img :src="file.url" alt="ÂõæÁâáÈ¢ÑËßà" />
                  </template>
                  <template v-else-if="isVideo(file.file)">
                    <video :src="file.url" preload="metadata"></video>
                  </template>
                  <template v-else>
                    üìÑ
                  </template>
                  <div class="upload-remove" @click.stop="removeUploadFile(index)">x</div>
                </div>
              </div>
            </div>
            <button class="send-button" @click="sendMessage" :disabled="!canSendMessage">ÂèëÈÄÅ</button>
          </div>
        </div>
      </div>
      <div class="chat-area" v-else>
        <div class="empty-chat">
          <p>ËØ∑ÈÄâÊã©‰∏Ä‰∏™ËÅîÁ≥ª‰∫∫ÂºÄÂßãËÅäÂ§©</p>
        </div>
      </div>
      
      <!-- Âè≥‰æßËØ¶ÊÉÖÂå∫Âüü -->
      <div class="detail-panel" v-if="activeContact">
        <div class="detail-header">
          <div class="detail-avatar">
            <img :src="activeContact.avatar" :alt="activeContact.name">
          </div>
          <div class="detail-name">{{ activeContact.name }}</div>
          <div class="detail-id">ID: {{ activeContact.id }}</div>
        </div>
        
        <div class="detail-section">
          <div class="section-title">Âü∫Êú¨‰ø°ÊÅØ</div>
          <div class="detail-item">
            <div class="item-icon">üë§</div>
            <div class="item-text">ÊòµÁß∞: {{ activeContact.name }}</div>
          </div>
          <div class="detail-item">
            <div class="item-icon">üîñ</div>
            <div class="item-text">Â§áÊ≥®: {{ activeContact.remark || 'Êó†' }}</div>
          </div>
          <div class="detail-item">
            <div class="item-icon">üì±</div>
            <div class="item-text">ÊâãÊú∫: {{ activeContact.phone || 'Êú™ËÆæÁΩÆ' }}</div>
          </div>
        </div>
        
        <div class="detail-section">
          <div class="section-title">ËÅäÂ§©ËÆ∞ÂΩï</div>
          <div class="detail-item">
            <div class="item-icon">üîç</div>
            <div class="item-text">Êü•ÊâæËÅäÂ§©ËÆ∞ÂΩï</div>
          </div>
          <div class="detail-item">
            <div class="item-icon">üìÇ</div>
            <div class="item-text">Êü•ÁúãÂõæÁâáÂíåÊñá‰ª∂</div>
          </div>
        </div>
        
        <div class="detail-section">
          <div class="section-title">ËÆæÁΩÆ</div>
          <div class="detail-item">
            <div class="item-icon">üîï</div>
            <div class="item-text">Ê∂àÊÅØÂÖçÊâìÊâ∞</div>
          </div>
          <div class="detail-item">
            <div class="item-icon">üìå</div>
            <div class="item-text">ÁΩÆÈ°∂ËÅäÂ§©</div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- ÂºïÂÖ• Vue 3 -->
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
  
  <script>
    const { createApp, ref, computed, nextTick, onMounted, watch } = Vue;
    
    createApp({
      setup() {
        // Ëé∑ÂèñÊú¨Âú∞Â≠òÂÇ®Êï∞ÊçÆ
        const savedContacts = localStorage.getItem('chatContacts');
        const savedActiveContactId = localStorage.getItem('activeContactId');
        // ËÅîÁ≥ª‰∫∫Êï∞ÊçÆÔºå‰ºòÂÖà‰ΩøÁî®Êú¨Âú∞Â≠òÂÇ®ÁöÑÊï∞ÊçÆ
        const contacts = ref(savedContacts ? JSON.parse(savedContacts) : [
          {
            id: 1,
            name: 'Âº†‰∏â',
            avatar: 'https://via.placeholder.com/40/3498db/ffffff?text=Âº†',
            lastMessage: 'ÊúÄËøëÂú®Âøô‰ªÄ‰πàÂë¢Ôºü',
            lastTime: '10:23',
            remark: 'Â§ßÂ≠¶ÂêåÂ≠¶',
            phone: '13800138000',
            messages: [
              {
                content: '‰Ω†Â•ΩÔºåÊúÄËøëÂú®Âπ≤‰ªÄ‰πàÂë¢Ôºü',
                time: 'Êò®Â§© 15:30',
                outgoing: false
              },
              {
                content: 'Âú®ÂøôÈ°πÁõÆÔºå‰Ω†Âë¢Ôºü',
                time: 'Êò®Â§© 15:35',
                outgoing: true
              },
              {
                content: 'Êàë‰πüÂú®ÂøôÂ∑•‰ΩúÔºå‰∏ãÂë®ÊúâÁ©∫‰∏ÄËµ∑ÂêÉÈ•≠Âêß',
                time: 'Êò®Â§© 15:40',
                outgoing: false
              },
              {
                content: 'Â•ΩÂïäÔºåÂà∞Êó∂ÂÄôÂÜçËÅîÁ≥ª',
                time: 'Êò®Â§© 15:42',
                outgoing: true
              },
              {
                content: 'ÊúÄËøëÂú®Âøô‰ªÄ‰πàÂë¢Ôºü',
                time: '‰ªäÂ§© 10:23',
                outgoing: false
              }
            ]
          },
          {
            id: 2,
            name: 'ÊùéÂõõ',
            avatar: 'https://via.placeholder.com/40/e74c3c/ffffff?text=Êùé',
            lastMessage: 'Âà´Âøò‰∫Ü‰∏ãÂë®‰∏ÄÁöÑ‰ºöËÆÆ',
            lastTime: 'Êò®Â§©',
            remark: 'È°πÁõÆÁªèÁêÜ',
            phone: '13900139000',
            messages: [
              {
                content: 'Âà´Âøò‰∫Ü‰∏ãÂë®‰∏ÄÁöÑ‰ºöËÆÆ',
                time: 'Êò®Â§© 18:30',
                outgoing: false
              }
            ]
          },
          {
            id: 3,
            name: 'Áéã‰∫î',
            avatar: 'https://via.placeholder.com/40/2ecc71/ffffff?text=Áéã',
            lastMessage: 'Êî∂Âà∞Êñá‰ª∂‰∫ÜÂêóÔºü',
            lastTime: '‰∏äÂë®',
            remark: '‰∫ßÂìÅËÆæËÆ°Â∏à',
            phone: '13700137000',
            messages: [
              {
                content: 'ÊàëÂèë‰∫Ü‰∏Ä‰ªΩËÆæËÆ°Êñá‰ª∂Áªô‰Ω†',
                time: '‰∏äÂë®‰∏â 14:20',
                outgoing: false
              },
              {
                content: 'Êî∂Âà∞‰∫ÜÔºåÊàëÂ∑≤ÁªèÂú®Áúã‰∫Ü',
                time: '‰∏äÂë®‰∏â 14:25',
                outgoing: true
              },
              {
                content: 'ÊúâÂá†‰∏™Âú∞ÊñπÈúÄË¶Å‰øÆÊîπÔºåÊàëÁ®çÂêéÂèëÂèçÈ¶àÁªô‰Ω†',
                time: '‰∏äÂë®‰∏â 14:30',
                outgoing: true
              },
              {
                content: 'Â•ΩÁöÑÔºåÊàëÁ≠â‰Ω†ÁöÑÂèçÈ¶à',
                time: '‰∏äÂë®‰∏â 14:35',
                outgoing: false
              },
              {
                content: 'Êî∂Âà∞Êñá‰ª∂‰∫ÜÂêóÔºü',
                time: '‰∏äÂë®‰∫î 09:30',
                outgoing: false
              }
            ]
          },
          {
            id: 4,
            name: 'Â∞èÁªÑÁæ§',
            avatar: 'https://via.placeholder.com/40/9b59b6/ffffff?text=ÁªÑ',
            lastMessage: 'Â∞èÊùé: Â§ßÂÆ∂ËÆ∞ÂæóÂáÜÊó∂Êèê‰∫§Âë®Êä•',
            lastTime: '08:53',
            remark: 'È°πÁõÆÁªÑ',
            phone: '',
            messages: [
              {
                content: 'Â∞èÊùé: Â§ßÂÆ∂Â•ΩÔºå‰ªäÂ§©‰∏ãÂçàÂõõÁÇπÂºÄ‰ºö',
                time: 'Êò®Â§© 08:30',
                outgoing: false
              },
              {
                content: 'Â∞èÁéã: Êî∂Âà∞',
                time: 'Êò®Â§© 08:35',
                outgoing: false
              },
              {
                content: 'Â•ΩÁöÑÔºåÊàë‰ºöÂáÜÊó∂ÂèÇÂä†',
                time: 'Êò®Â§© 08:40',
                outgoing: true
              },
              {
                content: 'Â∞èÊùé: Â§ßÂÆ∂ËÆ∞ÂæóÂáÜÊó∂Êèê‰∫§Âë®Êä•',
                time: '‰ªäÂ§© 08:53',
                outgoing: false
              }
            ]
          },
          {
            id: 5,
            name: 'ÂàòÂÖ≠',
            avatar: 'https://via.placeholder.com/40/f1c40f/ffffff?text=Âàò',
            lastMessage: 'Âë®Êú´ÊúâÁ©∫‰∏ÄËµ∑ÊâìÁêÉÂêóÔºü',
            lastTime: 'ÂâçÂ§©',
            remark: 'ÁØÆÁêÉ‰ºô‰º¥',
            phone: '13600136000',
            messages: [
              {
                content: 'Âë®Êú´ÊúâÁ©∫‰∏ÄËµ∑ÊâìÁêÉÂêóÔºü',
                time: 'ÂâçÂ§© 20:30',
                outgoing: false
              }
            ]
          }
        ]);
        
        const searchQuery = ref('');
        const activeContactId = ref(savedActiveContactId ? parseInt(savedActiveContactId) : null);
        const newMessage = ref('');
        const showEmojiPicker = ref(false);
        const uploadFiles = ref([]);
        const fileInput = ref(null);
        
        // È¢ÑËÆæË°®ÊÉÖÂàóË°®
        const emojiList = ref([
          'üòÄ', 'üòÅ', 'üòÇ', 'üòÉ', 'üòÑ', 'üòÖ', 'üòÜ', 'üòá', 
          'üòà', 'üòâ', 'üòä', 'üòã', 'üòå', 'üòç', 'üòé', 'üòè', 
          'üòê', 'üòë', 'üòí', 'üòì', 'üòî', 'üòï', 'üòñ', 'üòó', 
          'üòò', 'üòô', 'üòö', 'üòõ', 'üòú', 'üòù', 'üòû', 'üòü', 
          'üò†', 'üò°', 'üò¢', 'üò£', 'üò§', 'üò•', 'üò¶', 'üòß',
          'üò≠', 'üò±', 'üò≤', 'üò≥', 'üò∑', 'üôÇ', 'üôÉ', 'üôÑ', 
          '‚ù§Ô∏è', 'üëç', 'üëé', 'üëè', 'üëå', 'üëà', 'üëâ', 'üëë',
          'üéâ', 'üéÑ', 'üéÉ', 'üê∂', 'üê±', 'üê≠', 'üêπ', 'üê∞'
        ]);
        
        // Ê†πÊçÆÊêúÁ¥¢ËøáÊª§ËÅîÁ≥ª‰∫∫
        const filteredContacts = computed(() => {
          if (!searchQuery.value) return contacts.value;
          
          return contacts.value.filter(contact => 
            contact.name.toLowerCase().includes(searchQuery.value.toLowerCase()) ||
            (contact.remark && contact.remark.toLowerCase().includes(searchQuery.value.toLowerCase()))
          );
        });
        
        // Ëé∑ÂèñÂΩìÂâçÈÄâ‰∏≠ÁöÑËÅîÁ≥ª‰∫∫
        const activeContact = computed(() => {
          if (!activeContactId.value) return null;
          return contacts.value.find(contact => contact.id === activeContactId.value);
        });
        
        // Ê∂àÊÅØÂÆπÂô®ÂºïÁî®ÔºåÁî®‰∫éÊªöÂä®
        const messageContainer = ref(null);
        
        // ÈÄâÊã©ËÅîÁ≥ª‰∫∫
        function selectContact(id) {
          activeContactId.value = id;
          
          // ÊªöÂä®Âà∞ÊúÄÊñ∞Ê∂àÊÅØ
          nextTick(() => {
            scrollToBottom();
          });
        }
        
        // Êñá‰ª∂‰∏ä‰º†Áõ∏ÂÖ≥ÂáΩÊï∞
        function triggerFileUpload() {
          fileInput.value.click();
        }
        
        function handleFileUpload(event) {
          const files = event.target.files;
          if (!files.length) return;
          
          for (let i = 0; i < files.length; i++) {
            const file = files[i];
            const url = URL.createObjectURL(file);
            uploadFiles.value.push({
              file,
              url,
              type: file.type,
              name: file.name,
              size: formatFileSize(file.size)
            });
          }
          
          // ÈáçÁΩÆÊñá‰ª∂ËæìÂÖ•Ê°ÜÔºåÂÖÅËÆ∏ÂÜçÊ¨°ÈÄâÊã©Áõ∏ÂêåÊñá‰ª∂
          event.target.value = '';
        }
        
        function removeUploadFile(index) {
          if (uploadFiles.value[index].url) {
            URL.revokeObjectURL(uploadFiles.value[index].url);
          }
          uploadFiles.value.splice(index, 1);
        }
        
        function isImage(file) {
          return file.type.startsWith('image/');
        }
        
        function isVideo(file) {
          return file.type.startsWith('video/');
        }
        
        function isImageOrVideo(file) {
          return isImage(file) || isVideo(file);
        }
        
        function formatFileSize(bytes) {
          if (bytes < 1024) return bytes + ' B';
          if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
          return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
        }
        
        function previewMedia(url) {
          // Âú®ËøôÈáåÂèØ‰ª•ÂÆûÁé∞ÂÖ®Â±èÈ¢ÑËßàÂäüËÉΩ
          window.open(url, '_blank');
        }
        
        const canSendMessage = computed(() => {
          return (newMessage.value.trim() !== '' || uploadFiles.value.length > 0) && activeContactId.value !== null;
        });
        
        // ÂèëÈÄÅÊ∂àÊÅØ
        function sendMessage() {
          if (!canSendMessage.value) return;
          
          const contact = contacts.value.find(c => c.id === activeContactId.value);
          
          if (contact) {
            // Ê∑ªÂä†Êñ∞Ê∂àÊÅØ
            const now = new Date();
            const messageObj = {
              content: newMessage.value.trim(),
              timestamp: now.getTime(),
              time: formatMessageTime(now),
              outgoing: true
            };
            
            // Â§ÑÁêÜ‰∏ä‰º†ÁöÑÊñá‰ª∂
            uploadFiles.value.forEach(file => {
              if (isImage(file.file)) {
                messageObj.image = file.url;
              } else if (isVideo(file.file)) {
                messageObj.video = file.url;
              } else {
                messageObj.file = file.url;
                messageObj.fileName = file.name;
                messageObj.fileSize = file.size;
              }
            });
            
            contact.messages.push(messageObj);
            
            // Êõ¥Êñ∞ÊúÄÂêé‰∏ÄÊù°Ê∂àÊÅØ
            contact.lastMessage = newMessage.value;
            contact.lastTime = 'ÂàöÂàö';
            
            // Ê∏ÖÁ©∫ËæìÂÖ•ÂíåÊñá‰ª∂
            newMessage.value = '';
            uploadFiles.value = [];
            
            // ÊªöÂä®Âà∞Â∫ïÈÉ®
            nextTick(() => {
              scrollToBottom();
            });
            
            // Ê®°ÊãüËá™Âä®ÂõûÂ§ç
            setTimeout(() => {
              const autoResponses = [
                'Â•ΩÁöÑÔºåÊàëÁü•ÈÅì‰∫Ü',
                'Êî∂Âà∞',
                'Á®çÁ≠âÔºåÊàëÂ§ÑÁêÜ‰∏Ä‰∏ã',
                'Ë∞¢Ë∞¢‰Ω†ÁöÑ‰ø°ÊÅØ',
                'ÁïôË®ÄÊî∂Âà∞ÔºåÊàëÁ®çÂêéÂõûÂ§ç‰Ω†'
              ];
              
              const randomResponse = autoResponses[Math.floor(Math.random() * autoResponses.length)];
              const responseTime = new Date();
              
              contact.messages.push({
                content: randomResponse,
                timestamp: responseTime.getTime(),
                time: formatMessageTime(responseTime),
                outgoing: false
              });
              
              contact.lastMessage = randomResponse;
              
              nextTick(() => {
                scrollToBottom();
              });
            }, 1000);
          }
        }
        
        // ÂàáÊç¢Ë°®ÊÉÖÈÄâÊã©Âô®ÊòæÁ§∫Áä∂ÊÄÅ
        function toggleEmojiPicker() {
          showEmojiPicker.value = !showEmojiPicker.value;
        }
        
        // ÈÄâÊã©Ë°®ÊÉÖ
        function selectEmoji(emoji) {
          newMessage.value += emoji;
          showEmojiPicker.value = false;
        }
        
        // Ê†ºÂºèÂåñÊ∂àÊÅØÊó∂Èó¥
        function formatMessageTime(date, isRealtime = false) {
          if (!(date instanceof Date)) {
            date = new Date(date);
          }
          
          const now = new Date();
          const diffSeconds = Math.floor((now - date) / 1000);
          
          // Â∞è‰∫é10ÁßíÔºöÊòæÁ§∫‚ÄúÂàöÂàö‚Äù
          if (diffSeconds < 10) {
            return 'ÂàöÂàö';
          }
          
          // Â∞è‰∫é1ÂàÜÈíüÔºöÊòæÁ§∫nÁßí
          if (diffSeconds < 60) {
            return `${diffSeconds}Áßí`;
          }
          
          const diffMinutes = Math.floor(diffSeconds / 60);
          
          // Â∞è‰∫é1Â∞èÊó∂ÔºöÊòæÁ§∫nÂàÜÈíü
          if (diffMinutes < 60) {
            return `${diffMinutes}ÂàÜÈíü`;
          }
          
          const diffHours = Math.floor(diffMinutes / 60);
          const sameDay = (
            date.getDate() === now.getDate() && 
            date.getMonth() === now.getMonth() && 
            date.getFullYear() === now.getFullYear()
          );
          
          // Â∞è‰∫é24Â∞èÊó∂‰∏îÊòØÂΩìÂ§©ÔºöÊòæÁ§∫‚ÄúnÂ∞èÊó∂‚Äù
          if (diffHours < 24 && sameDay) {
            return `${diffHours}Â∞èÊó∂`;
          }
          
          // Ê£ÄÊü•ÊòØÂê¶ÊòØÊò®Â§©
          const yesterday = new Date(now);
          yesterday.setDate(yesterday.getDate() - 1);
          const isYesterday = (
            date.getDate() === yesterday.getDate() && 
            date.getMonth() === yesterday.getMonth() && 
            date.getFullYear() === yesterday.getFullYear()
          );
          
          // ÊòØÊò®Â§©ÔºöÊòæÁ§∫‚ÄúÊò®Â§© HH:MM‚Äù
          if (isYesterday) {
            const hours = date.getHours().toString().padStart(2, '0');
            const minutes = date.getMinutes().toString().padStart(2, '0');
            return `Êò®Â§© ${hours}:${minutes}`;
          }
          
          // Êõ¥Êó©ÁöÑÊó∂Èó¥ÔºöÊòæÁ§∫‚ÄúMM-DD HH:MM‚Äù
          const month = (date.getMonth() + 1).toString().padStart(2, '0');
          const day = date.getDate().toString().padStart(2, '0');
          const hours = date.getHours().toString().padStart(2, '0');
          const minutes = date.getMinutes().toString().padStart(2, '0');
          
          return `${month}-${day} ${hours}:${minutes}`;
        }
        
        // Êõ¥Êñ∞ÊâÄÊúâÊ∂àÊÅØÊó∂Èó¥ÊòæÁ§∫
        function updateAllMessageTimes() {
          contacts.value.forEach(contact => {
            contact.messages.forEach(message => {
              if (message.timestamp) {
                message.time = formatMessageTime(message.timestamp);
              }
            });
          });
        }
        
        // ÊØèÂàÜÈíüÊõ¥Êñ∞‰∏ÄÊ¨°Ê∂àÊÅØÊó∂Èó¥ÊòæÁ§∫
        setInterval(updateAllMessageTimes, 60000);
        
        // ÁÇπÂáªÈ°µÈù¢ÂÖ∂‰ªñÂå∫ÂüüÂÖ≥Èó≠Ë°®ÊÉÖÈÄâÊã©Âô®
        function closeEmojiPicker(event) {
          if (showEmojiPicker.value && !event.target.closest('.emoji-picker-container') && !event.target.closest('.emoji-button')) {
            showEmojiPicker.value = false;
          }
        }
        
        // ÊªöÂä®Âà∞ÊúÄÊñ∞Ê∂àÊÅØ
        function scrollToBottom() {
          if (messageContainer.value) {
            messageContainer.value.scrollTop = messageContainer.value.scrollHeight;
          }
        }
        
        // ÁõëÂê¨ËÅîÁ≥ª‰∫∫ÂèòÂåñÔºå‰øùÂ≠òÂà∞Êú¨Âú∞Â≠òÂÇ®
        watch(contacts, (newContacts) => {
          localStorage.setItem('chatContacts', JSON.stringify(newContacts));
        }, { deep: true });
        
        // ÁõëÂê¨ÂΩìÂâçÈÄâ‰∏≠ÁöÑËÅîÁ≥ª‰∫∫ÂèòÂåñ
        watch(activeContactId, (newId) => {
          localStorage.setItem('activeContactId', newId);
        });
        
        // ÂàùÂßãÂåñÊó∂ÈÄâÊã©Á¨¨‰∏Ä‰∏™ËÅîÁ≥ª‰∫∫
        onMounted(() => {
          // Ê∑ªÂä†ÁÇπÂáª‰∫ã‰ª∂ÁõëÂê¨ÔºåÂÖ≥Èó≠Ë°®ÊÉÖÈÄâÊã©Âô®
          document.addEventListener('click', closeEmojiPicker);
          
          if (contacts.value.length > 0) {
            selectContact(contacts.value[0].id);
          }
        });
        
        return {
          contacts,
          searchQuery,
          filteredContacts,
          activeContactId,
          activeContact,
          newMessage,
          messageContainer,
          selectContact,
          sendMessage,
          showEmojiPicker,
          toggleEmojiPicker,
          selectEmoji,
          emojiList,
          uploadFiles,
          fileInput,
          triggerFileUpload,
          handleFileUpload,
          removeUploadFile,
          isImage,
          isVideo,
          isImageOrVideo,
          previewMedia,
          canSendMessage
        };
      }
    }).mount('#app');
  </script>
</body>
</html>
